# シグナルアーキテクチャ・リファクタリング作業報告

AudioシグナルとControlシグナルの扱いを明確に分離するため、各コンポーネントレベルでパラメータのスケーリング（最小値・最大値）を定義するようにアーキテクチャを改善しました。

## 変更内容

### 1. `AudioNodeManager` のリファクタリング
- **削除**: ハードコードされていた定数 `controlScales` を削除しました。
- **更新**: `registerAudioNode` メソッドを更新し、コントロール入力の範囲（min/max）を定義する `params` オブジェクトを受け取れるようにしました。
- **実装**: 動的なスケーリングロジックを実装しました。
    - ターゲットプロパティに対して `params` が提供された場合、ソースとターゲットの間に自動的に `Tone.Scale` が生成されます。
    - `params` がない場合（または通常のAudio接続の場合）、直接接続されます。

### 2. コンポーネントの更新
以下のコンポーネントが、それぞれ独自のパラメータ範囲を定義するように更新しました：
- **`NodeVCO`**: 
    - `frequency`: 20Hz - 2000Hz
    - `detune`: -100 - 100
- **`NodeFilter`**: 
    - `frequency`: 200Hz - 5000Hz
    - `Q`: 0.1 - 20
- **`NodeLFO`**:
    - `frequency`: 0.1 - 20
    - `amplitude`: 0 - 1
- **`NodeDelay`**:
    - `delayTime`: 0 - 1
    - `feedback`: 0 - 1

### 3. 検証結果
- **コードロジック**: 依存関係の連鎖を確認しました。React Flowのエッジが更新されると、`NodeEditor` は `registerAudioNode` 関数のアイデンティティを更新し、それが各コンポーネントの `useEffect` フックをトリガーします。これによりノードが `AudioNodeManager` に再登録され、正しいスケーリング設定で接続が再構築されます。
- **動作確認**: ブラウザのコンソールログにて、各ノードが新しい `params` オブジェクトを伴って登録されていることを確認しました。

## 今後のステップ
ユーザーは LFO を Frequency や Filter Cutoff などの入力に自由に接続できるようになりました。アプリケーションはシグナルのスケーリングを自動的に処理するため、「Audio vs CV」の混乱が生じることなく、音楽的な結果（例：可聴域内でのLFOによる周波数変調）が得られます。
